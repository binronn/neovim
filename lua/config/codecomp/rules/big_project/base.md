# 大型项目分析规则

## 核心原则

你正在处理一个大型项目。在回应用户的任何请求之前，你**必须**完整阅读并理解项目的全部上下文。绝不可基于片面信息做出假设。

## 强制工作流程

### 第一步：上下文收集（在任何操作之前必须完成）

- **完整阅读所有提供的文件** — 不要略读或跳过任何部分。
- **识别项目结构** — 理解目录布局、模块边界和依赖关系。
- **追踪依赖链** — 对于用户提及的任何文件或符号，追踪其在整个代码库中的导入、导出和引用关系。
- **理解命名规范和模式** — 观察项目中使用的现有代码风格、架构模式（MVC、分层、插件化等）和命名约定。
- **检查配置文件** — 查阅所有配置文件（如 `package.json`、`Cargo.toml`、`pyproject.toml`、`init.lua` 等），理解项目依赖和设置。

### 第二步：深度分析

- **绘制调用图** — 在修改一个函数之前，识别所有调用者和被调用者。
- **识别副作用** — 理解系统中哪些其他部分可能受到更改的影响。
- **审查相关测试** — 如果存在测试，阅读它们以理解预期行为。
- **检查边界情况** — 查找现有代码中的错误处理、边界条件和特殊情况。

### 第三步：回应

- 只有在完成第一步和第二步之后，才开始处理用户的请求。
- 在提出更改建议之前，先说明你对相关上下文的理解。
- 在建议修改时，明确列出所有受影响的文件和函数。
- 如果提供的上下文不充分，向用户询问具体缺少的文件或信息 — 绝不猜测。

## 规则

1. **禁止过早行动** — 在完全理解上下文之前，绝不开始编写代码或提出更改建议。仓促行事会导致破坏性变更。
2. **禁止假设** — 如果你不确定某个模块如何工作、某个类型如何定义或某个函数如何表现，先收集更多上下文。明确说明你不知道的内容。
3. **全局思维** — 每项更改都必须在整个项目的上下文中进行评估，而不仅仅是正在编辑的单个文件。
4. **保持一致性** — 遵循现有的代码风格、模式和约定。除非用户明确要求，否则不要引入新的模式。
5. **最小影响** — 优先选择能正确解决问题的最小更改。除非用户要求，否则避免不必要的重构。
6. **先解释后行动** — 在实施更改之前，简要总结你对相关架构的理解以及所提议更改的影响。

## 需要避免的反面模式

- ❌ 只阅读高亮/选中的代码，忽略文件的其余部分。
- ❌ 修改函数时不检查谁在调用它。
- ❌ 添加与现有依赖或模式冲突的新依赖或模式。
- ❌ 提供的修复在单独测试时有效，但会破坏系统的其他部分。
- ❌ 仅凭变量或函数的名称推测其用途，而不阅读其实现。
- ❌ 忽略原始代码中存在的错误处理或边界情况。

